{% comment %}
  Partial pour l'affichage des résultats de recherche
  Paramètres:
  - on_click: handler supplémentaire lors du clic sur un résultat (optionnel)
  - container_class: classes CSS pour le conteneur (optionnel)
{% endcomment %}
<div x-show="query.length >= 2" class="{{ container_class|default:'max-h-96 overflow-y-auto scroll-smooth' }}">

  <!-- Commands / Actions -->
  <div x-show="commands.length > 0" class="p-2">
    <div class="px-3 py-2 text-xs font-semibold text-base-content/60 uppercase tracking-wider">
      Actions
    </div>
    <template x-for="(cmd, index) in commands" :key="cmd.name + cmd.url">
      <a
        :href="cmd.url"
        {% if on_click %}@click="{{ on_click }}"{% endif %}
        @mouseenter="activeIndex = index"
        :class="isCommandActive(index) ? 'bg-base-300' : 'bg-transparent'"
        class="flex items-center gap-3 px-3 py-2 hover:bg-base-200 rounded-lg cursor-pointer transition-colors"
      >
        <div class="flex-shrink-0">
          <div :class="`bg-${cmd.color || 'primary'}/10 text-${cmd.color || 'primary'}`" class="rounded-lg w-8 h-8 flex items-center justify-center">
            <i :data-lucide="cmd.icon || 'terminal'" class="w-4 h-4"></i>
          </div>
        </div>
        <div class="flex-1 min-w-0">
          <div class="text-sm font-medium" x-html="highlightMatch(cmd.name, searchQuery)"></div>
        </div>
        <div x-show="cmd.kind === 'action'" class="flex-shrink-0">
          <i data-lucide="arrow-right" class="w-3.5 h-3.5 text-base-content/30"></i>
        </div>
        <div x-show="cmd.kind === 'navigate'" class="flex-shrink-0">
          <i data-lucide="chevron-right" class="w-3.5 h-3.5 text-base-content/30"></i>
        </div>
      </a>
    </template>
  </div>

  <!-- Search results -->
  <div x-show="results.length > 0" class="p-2">
    <div class="px-3 py-2 text-xs font-semibold text-base-content/60 uppercase tracking-wider">
      <span x-text="`${results.length} Result${results.length > 1 ? 's' : ''}`"></span>
    </div>
    <template x-for="(result, index) in results" :key="result.uuid">
      <a
        :href="result.url"
        {% if on_click %}@click="{{ on_click }}"{% endif %}
        @mouseenter="activeIndex = commands.length + index"
        :class="isResultActive(index) ? 'bg-base-300' : 'bg-transparent'"
        class="flex items-center gap-3 px-3 py-2 hover:bg-base-200 rounded-lg cursor-pointer transition-colors"
      >
        <div class="avatar placeholder flex-shrink-0">
          <div :class="`bg-${result.module_color || 'primary'} text-${result.module_color || 'primary'}-content`" class="rounded-full w-8 h-8 flex items-center justify-center overflow-hidden">
            <i :data-lucide="result.type_icon || 'search'" class="w-4 h-4"></i>
          </div>
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2">
            <div class="text-sm font-medium truncate flex-1" x-text="result.name"></div>
            <span x-show="result.date" class="text-xs text-base-content/50 flex-shrink-0 tabular-nums" x-text="result.date"></span>
          </div>
          <div class="text-xs text-base-content/60 flex items-center gap-2">
            <i
              :data-lucide="result.type_icon || 'tag'"
              class="w-3 h-3 flex-shrink-0"
              :class="`text-${result.module_color || 'primary'}`"
            ></i>
            <span class="truncate flex-1" x-html="highlightMatch(result.matched_value, searchQuery)"></span>
            <template x-for="tag in (result.tags || [])" :key="tag.label">
              <span class="badge badge-xs flex-shrink-0" :class="`badge-${tag.color || 'ghost'}`" x-text="tag.label"></span>
            </template>
          </div>
        </div>
      </a>
    </template>

    <!-- Load more button -->
    <div x-show="hasMore" class="px-3 py-2">
      <button
        @click="loadMore()"
        :disabled="loadingMore"
        class="w-full btn btn-sm btn-ghost"
      >
        <span x-show="!loadingMore">Load more...</span>
        <span x-show="loadingMore" class="loading loading-spinner loading-sm"></span>
      </button>
    </div>
  </div>

  <!-- No results -->
  <div x-show="commands.length === 0 && results.length === 0 && !loading" class="px-4 py-8 text-center">
    <i data-lucide="search-x" class="w-8 h-8 mx-auto mb-2 opacity-30"></i>
    <div class="text-sm text-base-content/60">No results found</div>
  </div>
</div>
