{% comment %}
  Partial pour l'affichage des résultats de recherche
  Paramètres:
  - on_click: handler supplémentaire lors du clic sur un résultat (optionnel)
  - container_class: classes CSS pour le conteneur (optionnel)
{% endcomment %}
<div x-show="query.length >= 2" class="{{ container_class|default:'max-h-96 overflow-y-auto scroll-smooth' }}">
  <div x-show="results.length > 0" class="p-2">
    <div class="px-3 py-2 text-xs font-semibold text-base-content/60 uppercase tracking-wider">
      <span x-text="`${results.length} Result${results.length > 1 ? 's' : ''}`"></span>
    </div>
    <template x-for="(result, index) in results" :key="result.uuid">
      <a
        :href="`/person/${result.uuid}`"
        {% if on_click %}@click="{{ on_click }}"{% endif %}
        @mouseenter="setActiveFromElement($el)"
        :class="isActive($el) ? 'bg-base-300' : 'bg-transparent'"
        class="flex items-center gap-3 px-3 py-2 hover:bg-base-200 rounded-lg cursor-pointer transition-colors"
      >
        <div class="avatar placeholder flex-shrink-0">
          <div class="bg-primary text-primary-content rounded-full w-8 h-8 flex items-center justify-center overflow-hidden">
            <template x-if="result.profile_image_url">
              <img :src="result.profile_image_url" :alt="result.name" class="w-full h-full object-cover"/>
            </template>
            <template x-if="!result.profile_image_url">
              <i :data-lucide="result.type_icon || 'user'" class="w-4 h-4"></i>
            </template>
          </div>
        </div>
        <div class="flex-1 min-w-0">
          <div class="text-sm font-medium truncate" x-text="result.name"></div>
          <div class="text-xs text-base-content/60 flex items-center gap-2">
            <i
              :data-lucide="result.match_type === 'uuid' ? 'fingerprint' : (result.match_type === 'name' ? 'user' : (result.type_icon || 'tag'))"
              class="w-3 h-3 flex-shrink-0"
              :class="{
                 'text-info': result.match_type === 'uuid',
                 'text-primary': result.match_type === 'name',
                 'text-success': result.match_type === 'attribute'
               }"
            ></i>
            <span class="truncate" x-html="highlightMatch(result.matched_value, searchQuery)"></span>
          </div>
        </div>
      </a>
    </template>

    <!-- Load more button -->
    <div x-show="hasMore" class="px-3 py-2">
      <button
        @click="loadMore()"
        :disabled="loadingMore"
        class="w-full btn btn-sm btn-ghost"
      >
        <span x-show="!loadingMore">Load more...</span>
        <span x-show="loadingMore" class="loading loading-spinner loading-sm"></span>
      </button>
    </div>
  </div>

  <!-- No results -->
  <div x-show="results.length === 0 && !loading" class="px-4 py-8 text-center">
    <i data-lucide="search-x" class="w-8 h-8 mx-auto mb-2 opacity-30"></i>
    <div class="text-sm text-base-content/60">No results found</div>
  </div>
</div>
