<!-- Create Folder Dialog -->
<dialog id="create-folder-dialog" class="modal">
  <div class="modal-box" x-data>
    <h3 class="font-bold text-lg mb-4">Create New Folder</h3>
    <form @submit.prevent="$dispatch('create-folder', { name: $refs.folderName.value })">
      <div class="form-control">
        <label class="label">
          <span class="label-text">Folder name</span>
        </label>
        <input
          x-ref="folderName"
          type="text"
          placeholder="New folder"
          class="input input-bordered w-full"
          required
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn btn-sm" onclick="document.getElementById('create-folder-dialog').close()">Cancel</button>
        <button type="submit" class="btn btn-primary btn-sm">Create</button>
      </div>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<!-- Create File Dialog -->
<dialog id="create-file-dialog" class="modal">
  <div class="modal-box" x-data="{ fileType: 'txt' }">
    <h3 class="font-bold text-lg mb-4">Create New File</h3>
    <form @submit.prevent="$dispatch('create-file', { name: $refs.fileName.value, fileType, customExt: $refs.customExt ? $refs.customExt.value : '' })">
      <div class="form-control mb-3">
        <label class="label">
          <span class="label-text">File name</span>
        </label>
        <input
          x-ref="fileName"
          type="text"
          placeholder="notes"
          class="input input-bordered w-full"
          required
        />
        <label class="label">
          <span class="label-text-alt">Extension added if missing</span>
        </label>
      </div>
      <div class="form-control">
        <label class="label">
          <span class="label-text">Type</span>
        </label>
        <select x-model="fileType" class="select select-bordered w-full">
          <option value="txt">Text (.txt)</option>
          <option value="md">Markdown (.md)</option>
          <option value="json">JSON (.json)</option>
          <option value="csv">CSV (.csv)</option>
          <option value="custom">Custom extension</option>
        </select>
      </div>
      <div class="form-control mt-3" x-show="fileType === 'custom'" x-cloak>
        <label class="label">
          <span class="label-text">Extension</span>
        </label>
        <input
          x-ref="customExt"
          type="text"
          placeholder="log"
          class="input input-bordered w-full"
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn btn-sm" onclick="document.getElementById('create-file-dialog').close()">Cancel</button>
        <button type="submit" class="btn btn-primary btn-sm">Create</button>
      </div>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<!-- Help Dialog -->
<dialog id="help-dialog" class="modal">
  <div class="modal-box max-w-3xl">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
        <i data-lucide="x" class="w-4 h-4"></i>
      </button>
    </form>
    <h3 class="font-bold text-xl mb-6 flex items-center gap-2">
      <i data-lucide="circle-help" class="w-6 h-6 text-info"></i>
      Help
    </h3>

    <div class="space-y-2">
      <!-- Keyboard Shortcuts -->
      <div class="collapse collapse-arrow bg-base-200 rounded-lg">
        <input type="radio" name="help-accordion" />
        <div class="collapse-title font-semibold flex items-center gap-2">
          <i data-lucide="keyboard" class="w-4 h-4 text-primary"></i>
          Keyboard Shortcuts
        </div>
        <div class="collapse-content">
          <div class="prose prose-sm max-w-none pt-2">
            <h4 class="font-semibold mt-0 mb-2">Selection shortcuts</h4>
            <p class="text-xs opacity-70 mt-0 mb-2">Select one or more items using checkboxes, then press a shortcut.</p>
            <table class="table table-sm">
              <tbody>
                <tr><td><kbd class="kbd kbd-sm">Enter</kbd> / <kbd class="kbd kbd-sm">Space</kbd></td><td>Open folder / View file</td><td class="text-xs opacity-60">single</td></tr>
                <tr><td><kbd class="kbd kbd-sm">F2</kbd></td><td>Rename</td><td class="text-xs opacity-60">single</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Del</kbd></td><td>Delete</td><td class="text-xs opacity-60">single / multi</td></tr>
                <tr><td><kbd class="kbd kbd-sm">F</kbd></td><td>Toggle favorite</td><td class="text-xs opacity-60">single / multi</td></tr>
                <tr><td><kbd class="kbd kbd-sm">P</kbd></td><td>Pin / unpin from sidebar</td><td class="text-xs opacity-60">single folder</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Ctrl</kbd> + <kbd class="kbd kbd-sm">X</kbd></td><td>Cut</td><td class="text-xs opacity-60">single / multi</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Ctrl</kbd> + <kbd class="kbd kbd-sm">C</kbd></td><td>Copy</td><td class="text-xs opacity-60">single / multi</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Ctrl</kbd> + <kbd class="kbd kbd-sm">V</kbd></td><td>Paste</td><td class="text-xs opacity-60">no selection needed</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Ctrl</kbd> + <kbd class="kbd kbd-sm">I</kbd></td><td>Properties</td><td class="text-xs opacity-60">single</td></tr>
              </tbody>
            </table>
            <h4 class="font-semibold mt-3 mb-2">File Editor</h4>
            <table class="table table-sm">
              <tbody>
                <tr><td><kbd class="kbd kbd-sm">Ctrl</kbd> + <kbd class="kbd kbd-sm">S</kbd></td><td>Save</td></tr>
                <tr><td><kbd class="kbd kbd-sm">Esc</kbd></td><td>Cancel editing</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- WebDAV Access -->
      <div class="collapse collapse-arrow bg-base-200 rounded-lg">
        <input type="radio" name="help-accordion" />
        <div class="collapse-title font-semibold flex items-center gap-2">
          <i data-lucide="hard-drive" class="w-4 h-4 text-primary"></i>
          WebDAV Access
        </div>
        <div class="collapse-content">
          <div class="prose prose-sm max-w-none pt-2">
            <p>Mount your files as a network drive using WebDAV. Your WebDAV URL is:</p>
            <code class="block bg-base-300 px-3 py-2 rounded text-sm mb-3">https://&lt;your-domain&gt;/dav/</code>

            <h4 class="font-semibold mt-3 mb-1">Windows</h4>
            <ol>
              <li>Open File Explorer and click <strong>Map network drive</strong>.</li>
              <li>Enter the WebDAV URL as the folder path.</li>
              <li>Check <em>Connect using different credentials</em> and enter your username and password.</li>
              <li>If connecting over HTTP, add a registry key to allow Basic auth:
                <code class="block bg-base-300 px-3 py-2 rounded text-xs mt-1">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WebClient\Parameters\BasicAuthLevel = 2</code>
                then restart the <em>WebClient</em> service.
              </li>
            </ol>

            <h4 class="font-semibold mt-3 mb-1">macOS</h4>
            <ol>
              <li>In Finder, press <kbd class="kbd kbd-sm">Cmd</kbd> + <kbd class="kbd kbd-sm">K</kbd>.</li>
              <li>Enter the WebDAV URL and click <strong>Connect</strong>.</li>
              <li>Enter your credentials when prompted.</li>
            </ol>

            <h4 class="font-semibold mt-3 mb-1">Linux</h4>
            <ol>
              <li>Install <code>davfs2</code>: <code>sudo apt install davfs2</code></li>
              <li>Mount via command line or add to <code>/etc/fstab</code>.</li>
              <li>Alternatively, use <strong>GNOME Files</strong> &gt; Other Locations &gt; Connect to Server.</li>
            </ol>

            <h4 class="font-semibold mt-3 mb-1">iOS / Android</h4>
            <p>Use a WebDAV-compatible app such as <strong>FE File Explorer</strong>, <strong>Solid Explorer</strong>, or <strong>Documents by Readdle</strong>.</p>
          </div>
        </div>
      </div>

      <!-- File Management -->
      <div class="collapse collapse-arrow bg-base-200 rounded-lg">
        <input type="radio" name="help-accordion" />
        <div class="collapse-title font-semibold flex items-center gap-2">
          <i data-lucide="folder-open" class="w-4 h-4 text-primary"></i>
          File Management
        </div>
        <div class="collapse-content">
          <div class="prose prose-sm max-w-none pt-2">
            <ul>
              <li><strong>Drag and drop</strong> &mdash; Drop files anywhere on the page to upload them to the current folder.</li>
              <li><strong>Pinned folders</strong> &mdash; Drag a folder onto the sidebar "Pinned" area to pin it for quick access.</li>
              <li><strong>Favorites</strong> &mdash; Right-click a file or folder and select <em>Add to favorites</em> to bookmark it.</li>
              <li><strong>Trash</strong> &mdash; Deleted items are moved to the Trash and can be restored or permanently removed.</li>
              <li><strong>Right-click menu</strong> &mdash; Right-click any item for options like rename, move, download, and more.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Supported File Types -->
      <div class="collapse collapse-arrow bg-base-200 rounded-lg">
        <input type="radio" name="help-accordion" />
        <div class="collapse-title font-semibold flex items-center gap-2">
          <i data-lucide="file-type" class="w-4 h-4 text-primary"></i>
          Supported File Types
        </div>
        <div class="collapse-content">
          <div class="prose prose-sm max-w-none pt-2">
            <p>The following file types can be previewed directly in the browser:</p>
            <ul>
              <li><strong>Images</strong> &mdash; JPEG, PNG, GIF, SVG, WebP, BMP, ICO</li>
              <li><strong>Documents</strong> &mdash; PDF, Markdown (rendered)</li>
              <li><strong>Text &amp; Code</strong> &mdash; Plain text, JSON, XML, YAML, HTML, CSS, JavaScript, Python, and many more (with syntax highlighting)</li>
              <li><strong>Media</strong> &mdash; Audio (MP3, WAV, OGG) and Video (MP4, WebM)</li>
            </ul>
            <p>All other file types can be downloaded.</p>
          </div>
        </div>
      </div>

      <!-- API Access -->
      <div class="collapse collapse-arrow bg-base-200 rounded-lg">
        <input type="radio" name="help-accordion" />
        <div class="collapse-title font-semibold flex items-center gap-2">
          <i data-lucide="code" class="w-4 h-4 text-primary"></i>
          API Access
        </div>
        <div class="collapse-content">
          <div class="prose prose-sm max-w-none pt-2">
            <p>A REST API is available for programmatic access to your files.</p>
            <ul>
              <li><strong>Base URL:</strong> <code>/api/v1/files</code></li>
              <li><strong>Authentication:</strong> Use your session cookie or API token.</li>
              <li><strong>Documentation:</strong> Full API docs are available at <a href="/api/docs" class="link link-primary">/api/docs</a>.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<!-- Rename Dialog -->
<dialog id="rename-dialog" class="modal">
  <div class="modal-box" x-data="{ uuid: '', name: '' }" @open-rename.window="uuid = $event.detail.uuid; name = $event.detail.name">
    <h3 class="font-bold text-lg mb-4">Rename</h3>
    <form @submit.prevent="$dispatch('rename-item', { uuid: uuid, name: $refs.newName.value })">
      <div class="form-control">
        <label class="label">
          <span class="label-text">New name</span>
        </label>
        <input
          x-ref="newName"
          x-model="name"
          type="text"
          class="input input-bordered w-full"
          required
        />
      </div>
      <div class="modal-action">
        <button type="button" class="btn btn-sm" onclick="document.getElementById('rename-dialog').close()">Cancel</button>
        <button type="submit" class="btn btn-primary btn-sm">Rename</button>
      </div>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
