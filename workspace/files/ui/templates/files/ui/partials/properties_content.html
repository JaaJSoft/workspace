{% load file_filters %}
{% comment %}
Properties Content Partial
==========================
Loaded via AJAX into the properties modal.

Context:
- file: File object
- is_favorite: boolean
- is_pinned: boolean (for folders)
- children_count: int (for folders)
- total_size: int (for folders, recursive size)
{% endcomment %}

<div class="space-y-4" x-data="folderIconPicker('{{ file.uuid }}', '{{ file.icon|default:"folder" }}', '{{ file.color|default:"text-warning" }}')">
  <!-- Name & Icon -->
  <div class="flex items-center gap-4 p-4 bg-base-200 rounded-lg">
    <div class="w-12 h-12 flex items-center justify-center bg-base-300 rounded-lg" x-ref="previewIcon" {% if file.node_type == 'folder' %}x-init="$nextTick(() => updatePreviewIcon())"{% endif %}>
      {% if file.node_type != 'folder' %}
        <i data-lucide="{{ file.mime_type|mime_to_lucide }}" class="w-8 h-8 {{ file.mime_type|mime_to_color }}"></i>
      {% endif %}
    </div>
    <div class="flex-1 min-w-0">
      <h4 class="font-semibold text-lg truncate">{{ file.name }}</h4>
      <p class="text-sm text-base-content/60">
        {% if file.node_type == 'folder' %}
          Folder
        {% else %}
          {{ file.mime_type|default:"Unknown type" }}
        {% endif %}
      </p>
    </div>
  </div>

  {% if file.node_type == 'folder' %}
  <!-- Icon Customization (folders only) -->
  <div class="p-4 bg-base-200 rounded-lg space-y-3">
    <h5 class="text-sm font-medium flex items-center gap-2">
      <i data-lucide="palette" class="w-4 h-4"></i>
      Customize Icon
    </h5>

    <!-- Icon Selection -->
    <div>
      <label class="text-xs text-base-content/60 mb-2 block">Icon</label>
      <div class="flex flex-wrap gap-1" x-ref="iconGrid" x-init="setTimeout(() => lucide.createIcons({nodes: $refs.iconGrid.querySelectorAll('[data-lucide]')}), 50)">
        <template x-for="icon in icons" :key="icon">
          <button
            type="button"
            class="btn btn-sm btn-square"
            :class="selectedIcon === icon ? 'btn-primary' : 'btn-ghost'"
            @click="selectIcon(icon)"
            :title="icon"
          >
            <i :data-lucide="icon" class="w-4 h-4 pointer-events-none"></i>
          </button>
        </template>
      </div>
    </div>

    <!-- Color Selection -->
    <div>
      <label class="text-xs text-base-content/60 mb-2 block">Color</label>
      <div class="flex flex-wrap gap-1" x-ref="colorGrid" x-init="setTimeout(() => lucide.createIcons({nodes: $refs.colorGrid.querySelectorAll('[data-lucide]')}), 50)">
        <template x-for="color in colors" :key="color.class">
          <button
            type="button"
            class="btn btn-sm btn-square btn-ghost"
            :class="selectedColor === color.class ? 'ring-2 ring-primary ring-offset-1' : ''"
            @click="selectColor(color.class)"
            :title="color.name"
          >
            <i data-lucide="circle" class="w-4 h-4 fill-current pointer-events-none" :class="color.class"></i>
          </button>
        </template>
      </div>
    </div>

    <!-- Save indicator -->
    <div x-show="saving" class="text-xs text-base-content/60 flex items-center gap-1">
      <span class="loading loading-spinner loading-xs"></span>
      Saving...
    </div>
    <div x-show="saved" x-transition class="text-xs text-success flex items-center gap-1">
      <i data-lucide="check" class="w-3 h-3"></i>
      Saved
    </div>
  </div>
  {% endif %}

  <!-- Properties Table -->
  <div class="overflow-x-auto">
    <table class="table table-sm">
      <tbody>
        <!-- Type -->
        <tr>
          <td class="text-base-content/60 w-32">Type</td>
          <td class="font-medium">
            {% if file.node_type == 'folder' %}
              Folder
            {% else %}
              File
            {% endif %}
          </td>
        </tr>

        <!-- Location -->
        <tr>
          <td class="text-base-content/60">Location</td>
          <td class="font-medium">
            <span class="text-sm font-mono bg-base-200 px-2 py-0.5 rounded">
              /{{ file.path }}
            </span>
          </td>
        </tr>

        {% if file.node_type == 'file' %}
        <!-- Size (files only) -->
        <tr>
          <td class="text-base-content/60">Size</td>
          <td class="font-medium">{{ file.size|filesizeformat }}</td>
        </tr>

        <!-- MIME Type -->
        <tr>
          <td class="text-base-content/60">MIME Type</td>
          <td class="font-medium font-mono text-sm">{{ file.mime_type|default:"-" }}</td>
        </tr>
        {% endif %}

        {% if file.node_type == 'folder' %}
        <!-- Contents (folders only) -->
        <tr>
          <td class="text-base-content/60">Contents</td>
          <td class="font-medium">
            {{ children_count }} item{{ children_count|pluralize }}
            {% if total_size %}
              <span class="text-base-content/50">({{ total_size|filesizeformat }} total)</span>
            {% endif %}
          </td>
        </tr>
        {% endif %}

        <!-- Created -->
        <tr>
          <td class="text-base-content/60">Created</td>
          <td class="font-medium">{{ file.created_at|date:"N j, Y, P" }}</td>
        </tr>

        <!-- Modified -->
        <tr>
          <td class="text-base-content/60">Modified</td>
          <td class="font-medium">{{ file.updated_at|date:"N j, Y, P" }}</td>
        </tr>

        <!-- Owner -->
        <tr>
          <td class="text-base-content/60">Owner</td>
          <td class="font-medium">{{ file.owner.username }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Status badges -->
  <div class="flex flex-wrap gap-2">
    {% if is_favorite %}
    <span class="badge badge-warning gap-1">
      <i data-lucide="star" class="w-3 h-3 fill-current"></i>
      Favorite
    </span>
    {% endif %}

    {% if is_pinned %}
    <span class="badge badge-primary gap-1">
      <i data-lucide="pin" class="w-3 h-3 fill-current"></i>
      Pinned
    </span>
    {% endif %}

    {% if file.deleted_at %}
    <span class="badge badge-error gap-1">
      <i data-lucide="trash-2" class="w-3 h-3"></i>
      In Trash
    </span>
    {% endif %}
  </div>

  <!-- UUID (collapsible) -->
  <details class="group bg-base-200 rounded-lg">
    <summary class="flex items-center justify-between cursor-pointer text-sm font-medium py-3 px-4 list-none">
      <span>Advanced</span>
      <i data-lucide="chevron-down" class="w-4 h-4 transition-transform group-open:rotate-180"></i>
    </summary>
    <div class="px-4 pb-3">
      <div class="text-sm">
        <span class="text-base-content/60">UUID:</span>
        <code class="ml-2 text-xs bg-base-300 px-2 py-0.5 rounded select-all">{{ file.uuid }}</code>
      </div>
    </div>
  </details>
</div>
